use bloodguysfinal;
create table `users` (`id` int unsigned not null auto_increment primary key, `name` varchar(255) not null, `email` varchar(255) not null, `password` varchar(60) not null, `remember_token` varchar(100) null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `users` add unique users_email_unique(`email`);
create table `password_resets` (`email` varchar(255) not null, `token` varchar(255) not null, `created_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `password_resets` add index password_resets_email_index(`email`);
alter table `password_resets` add index password_resets_token_index(`token`);
create table `hospitals` (`id` int unsigned not null auto_increment primary key, `name` varchar(255) not null, `street_address` varchar(100) not null, `street_address_2` varchar(100) not null, `city` varchar(100) not null, `state` varchar(2) not null, `zip_code` varchar(10) not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
create table `professions` (`id` int unsigned not null auto_increment primary key, `name` varchar(255) not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
create table `professionals` (`id` int unsigned not null auto_increment primary key, `first_name` varchar(50) not null, `last_name` varchar(50) not null, `profession_id` int unsigned not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `professionals` add constraint professionals_profession_id_foreign foreign key (`profession_id`) references `professions` (`id`) on delete cascade;
create table `invoices` (`id` int unsigned not null auto_increment primary key, `procedure_date` date not null, `last_step` varchar(255) not null, `next_step` varchar(255) not null, `completed` tinyint(1) not null, `hospital_id` int unsigned not null, `created_by` varchar(255) not null, `last_modified_by` varchar(255) not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `invoices` add constraint invoices_hospital_id_foreign foreign key (`hospital_id`) references `hospitals` (`id`) on delete cascade;
create table `staff_information` (`id` int unsigned not null auto_increment primary key, `anesthesiologist_id` int unsigned not null, `primary_autotransfusionist_id` int unsigned not null, `secondary_autotransfusionist_id` int unsigned not null, `surgeon_id` int unsigned not null, `invoice_id` int unsigned not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `staff_information` add constraint staff_information_anesthesiologist_id_foreign foreign key (`anesthesiologist_id`) references `professionals` (`id`);
alter table `staff_information` add constraint staff_information_primary_autotransfusionist_id_foreign foreign key (`primary_autotransfusionist_id`) references `professionals` (`id`);
alter table `staff_information` add constraint staff_information_secondary_autotransfusionist_id_foreign foreign key (`secondary_autotransfusionist_id`) references `professionals` (`id`);
alter table `staff_information` add constraint staff_information_surgeon_id_foreign foreign key (`surgeon_id`) references `professionals` (`id`);
alter table `staff_information` add constraint staff_information_invoice_id_foreign foreign key (`invoice_id`) references `invoices` (`id`) on delete cascade;
create table `patient_information` (`id` int unsigned not null auto_increment primary key, `first_name` varchar(1) not null, `last_name` varchar(60) not null, `patient_number` varchar(255) not null, `medical_record_number` varchar(255) not null, `invoice_id` int unsigned not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `patient_information` add constraint patient_information_invoice_id_foreign foreign key (`invoice_id`) references `invoices` (`id`) on delete cascade;
create table `procedure_information` (`id` int unsigned not null auto_increment primary key, `physician_order` tinyint(1) not null, `method_group` int not null, `procedure` varchar(255) not null, `operation_start_time` time not null, `collection_start_time` time not null, `operation_end_time` time not null, `wash_time` time not null, `invoice_id` int unsigned not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `procedure_information` add constraint procedure_information_invoice_id_foreign foreign key (`invoice_id`) references `invoices` (`id`) on delete cascade;
create table `lab_information` (`id` int unsigned not null auto_increment primary key, `pre_op_hematocrit` decimal(8, 2) not null, `date_taken` date not null, `invoice_id` int unsigned not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `lab_information` add constraint lab_information_invoice_id_foreign foreign key (`invoice_id`) references `invoices` (`id`) on delete cascade;
create table `processing_information` (`column_id` int unsigned not null, `amount_processed` int not null, `anticoagulent_volume` int not null, `irrigation_volume` int not null, `ebl` int not null, `rbcs_salvaged` int not null, `time` time not null, `invoice_id` int unsigned not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `processing_information` add constraint processing_information_invoice_id_foreign foreign key (`invoice_id`) references `invoices` (`id`) on delete cascade;
alter table `processing_information` add primary key processing_information_column_id_invoice_id_primary(`column_id`, `invoice_id`);
create table `procedure_totals` (`id` int unsigned not null auto_increment primary key, `ebl_or` int not null, `rbc_returned_or` int not null, `wash_amount_or` int not null, `vc_or` tinyint(1) not null, `cc_or` tinyint(1) not null, `ebl_po` int not null, `rbc_returned_po` int not null, `wash_amount_po` int not null, `vc_po` tinyint(1) not null, `cc_po` tinyint(1) not null, `ebl_po2` int not null, `rbc_returned_po2` int not null, `wash_amount_po2` int not null, `vc_po2` tinyint(1) not null, `cc_po2` tinyint(1) not null, `ebl_total` int not null, `rbc_returned_total` int not null, `wash_amount_total` int not null, `invoice_id` int unsigned not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `procedure_totals` add constraint procedure_totals_invoice_id_foreign foreign key (`invoice_id`) references `invoices` (`id`) on delete cascade;
create table `equipment` (`id` int unsigned not null auto_increment primary key, `device_name` varchar(50) not null, `manufacturer` varchar(50) not null, `serial_number` varchar(50) not null, `self_test_passed` tinyint(1) not null, `invoice_id` int unsigned not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `equipment` add constraint equipment_invoice_id_foreign foreign key (`invoice_id`) references `invoices` (`id`) on delete cascade;
create table `transfusion_services` (`id` int unsigned not null auto_increment primary key, `basic_service_quantity` int not null, `basic_service_charge` decimal(10, 2) not null, `basic_service_total` decimal(10, 2) not null, `modified_service_quantity` int not null, `modified_service_charge` decimal(10, 2) not null, `modified_service_total` decimal(10, 2) not null, `invoice_id` int unsigned not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `transfusion_services` add constraint transfusion_services_invoice_id_foreign foreign key (`invoice_id`) references `invoices` (`id`) on delete cascade;
create table `transfusion_supplies` (`id` int unsigned not null auto_increment primary key, `wash_kit_manufacturer` varchar(50) not null, `wash_kit_product_id_number` varchar(50) not null, `wash_kit_quantity` int not null, `wash_kit_charge` decimal(10, 2) not null, `wash_kit_total` decimal(19, 2) not null, `reservoir_manufacturer` varchar(50) not null, `reservoir_product_id_number` varchar(50) not null, `reservoir_quantity` int not null, `reservoir_charge` decimal(10, 2) not null, `reservoir_total` decimal(19, 2) not null, `aspiration_assembly_manufacturer` varchar(50) not null, `aspiration_assembly_product_id_number` varchar(50) not null, `aspiration_assembly_quantity` int not null, `aspiration_assembly_charge` decimal(10, 2) not null, `aspiration_assembly_total` decimal(19, 2) not null, `blood_bag_manufacturer` varchar(50) not null, `blood_bag_product_id_number` varchar(50) not null, `blood_bag_quantity` int not null, `blood_bag_charge` decimal(10, 2) not null, `blood_bag_total` decimal(19, 2) not null, `vacuum_tubing_manufacturer` varchar(50) not null, `vacuum_tubing_product_id_number` varchar(50) not null, `vacuum_tubing_quantity` int not null, `vacuum_tubing_charge` decimal(10, 2) not null, `vacuum_tubing_total` decimal(19, 2) not null, `wound_drain_manufacturer` varchar(50) not null, `wound_drain_product_id_number` varchar(50) not null, `wound_drain_quantity` int not null, `wound_drain_charge` decimal(10, 2) not null, `wound_drain_total` decimal(19, 2) not null, `y_connector_manufacturer` varchar(50) not null, `y_connector_product_id_number` varchar(50) not null, `y_connector_quantity` int not null, `y_connector_charge` decimal(10, 2) not null, `y_connector_total` decimal(19, 2) not null, `blood_filter_manufacturer` varchar(50) not null, `blood_filter_product_id_number` varchar(50) not null, `blood_filter_quantity` int not null, `blood_filter_charge` decimal(10, 2) not null, `blood_filter_total` decimal(19, 2) not null, `acda_bag_manufacturer` varchar(50) not null, `acda_bag_product_id_number` varchar(50) not null, `acda_bag_quantity` int not null, `acda_bag_charge` decimal(10, 2) not null, `acda_bag_total` decimal(19, 2) not null, `misc_manufacturer` varchar(50) not null, `misc_product_id_number` varchar(50) not null, `misc_quantity` int not null, `misc_charge` decimal(10, 2) not null, `misc_total` decimal(19, 2) not null, `invoice_id` int unsigned not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `transfusion_supplies` add constraint transfusion_supplies_invoice_id_foreign foreign key (`invoice_id`) references `invoices` (`id`) on delete cascade;
create table `invoice_user` (`id` int unsigned not null auto_increment primary key, `invoice_id` int unsigned not null, `user_id` int unsigned not null) default character set utf8 collate utf8_unicode_ci;
alter table `invoice_user` add constraint invoice_user_invoice_id_foreign foreign key (`invoice_id`) references `invoices` (`id`) on delete cascade;
alter table `invoice_user` add constraint invoice_user_user_id_foreign foreign key (`user_id`) references `users` (`id`) on delete cascade;
create table `invoice_sections` (`id` int unsigned not null auto_increment primary key, `display_name` varchar(30) not null, `process_step` int not null, `title` varchar(30) not null, `update_button_text` varchar(30) not null, `form_path` varchar(255) not null, `create_url` varchar(50) not null, `edit_url` varchar(50) not null, `update_url` varchar(50) not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `invoice_sections` add unique invoice_sections_process_step_unique(`process_step`);
create table `invoice_invoice_section` (`id` int unsigned not null auto_increment primary key, `invoice_id` int unsigned not null, `invoice_section_id` int unsigned not null, `completed` tinyint(1) not null default '0', `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `invoice_invoice_section` add constraint invoice_invoice_section_invoice_id_foreign foreign key (`invoice_id`) references `invoices` (`id`) on delete cascade;
alter table `invoice_invoice_section` add constraint invoice_invoice_section_invoice_section_id_foreign foreign key (`invoice_section_id`) references `invoice_sections` (`id`) on delete cascade;
alter table `invoice_sections` add `save_url` varchar(50) not null after `update_url`;
create table `invoice_files` (`id` int unsigned not null auto_increment primary key, `filename` varchar(150) not null, `invoice_id` int unsigned not null, `created_at` timestamp default 0 not null, `updated_at` timestamp default 0 not null) default character set utf8 collate utf8_unicode_ci;
alter table `invoice_files` add constraint invoice_files_invoice_id_foreign foreign key (`invoice_id`) references `invoices` (`id`) on delete cascade;
alter table `invoices` add `po_number` varchar(20) null after `hospital_id`, add `special_notes` varchar(5000) null after `po_number`;
alter table `invoices` drop `next_step`;
alter table `invoices` drop `last_step`;
ALTER TABLE procedure_information CHANGE collection_start_time collection_start_time TIME DEFAULT NULL, CHANGE wash_time wash_time VARCHAR(8) DEFAULT NULL;
alter table `procedure_information` add `total_time` time not null after `operation_end_time`;
ALTER TABLE staff_information CHANGE secondary_autotransfusionist_id secondary_autotransfusionist_id INT UNSIGNED DEFAULT NULL;
ALTER TABLE lab_information CHANGE pre_op_hematocrit pre_op_hematocrit NUMERIC(8, 2) DEFAULT NULL, CHANGE date_taken date_taken DATE DEFAULT NULL;
ALTER TABLE equipment CHANGE device_name device_name VARCHAR(50) DEFAULT NULL COLLATE utf8_unicode_ci, CHANGE manufacturer manufacturer VARCHAR(50) DEFAULT NULL COLLATE utf8_unicode_ci, CHANGE serial_number serial_number VARCHAR(50) DEFAULT NULL COLLATE utf8_unicode_ci, CHANGE self_test_passed self_test_passed TINYINT(1) DEFAULT NULL;
alter table `transfusion_supplies` add `supplies_total` decimal(10, 2) not null;
alter table `hospitals` add `anticoagulent_volume` int not null after `state`;
alter table `hospitals` drop `street_address`;
alter table `hospitals` drop `street_address_2`;
alter table `hospitals` drop `zip_code`;
alter table `users` add `admin` tinyint(1) not null;
ALTER TABLE staff_information CHANGE anesthesiologist_id anesthesiologist_id INT UNSIGNED DEFAULT NULL;
alter table `hospitals` drop `city`;
